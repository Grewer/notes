## èµ·å› 
åœºæ™¯ä¸€:  
å½“å‰é¡¹ç›®ç»å†äº†åˆ€è€•ç«ç§åœ°å¼€å‘, ä¹‹åæ¥å…¥äº† cli å·¥å…·é›†ä¸­ç®¡ç†æ‰“åŒ…, é‚£ä¹ˆé¡¹ç›®ä¸­çš„ä¾èµ–,
å’Œ cli å·¥å…·ä¸­çš„ä¾èµ–é‡åˆåº¦æ˜¯å¤šå°‘, å¹¶ä¸”ä»–çš„çš„ç‰ˆæœ¬æ˜¯å¦ç›¸åŒ, æ˜¯å¦æœ‰å†—ä½™ä»£ç 

åœºæ™¯äºŒ:  
é¡¹ç›®ä¸­æŸä¸€ä¸ªåº“å‡çº§äº†, ä»–ä¾èµ–äº† A åº“çš„ V3 ç‰ˆæœ¬, åŒæ—¶å½“å‰é¡¹ç›®ä¾èµ–çš„æ˜¯ A åº“ V2ç‰ˆæœ¬, è¿™ä¸ªæ—¶å€™æ‰“åŒ…å¾ˆæ˜æ˜¾, å°±ä¼šå°†è¿™ä¸€ä¸ªåŒ…çš„ä¸åŒç‰ˆæœ¬åŒæ—¶æ‰“å…¥

ç”±äºä¸Šè¿°çš„åœºæ™¯, æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·æ¥è§£å†³è¿™äº›æƒ…å†µ

## æ€è€ƒğŸ¤”

> è¿™äº›åœºæ™¯æ”¹å¦‚ä½•è§£å†³, è§£å†³çš„æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ
>

ç›®å‰è®¡åˆ’æ˜¯é€šè¿‡ node è„šæœ¬æ¥è¿è¡Œ
- æ£€æŸ¥ node_modules æˆ–è€… lock æ–‡ä»¶ä¸­, æ˜¯å¦å­˜åœ¨åŒä¸€åº“çš„å¤šä¸ªç‰ˆæœ¬

- node_modules æ–‡ä»¶å±‚çº§å¤ªå¤š, lock æ–‡ä»¶æ˜¯ä»–çš„ä¸€å±‚æ˜ å°„, è€ƒè™‘ä»è¿™é‡Œå…¥æ‰‹

- ç¡®ä¿ lock æ–‡ä»¶æ˜¯æœ€æ–°çš„, é‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œä¸€é `npm i` æŒ‡ä»¤, é’ˆå¯¹ lock çš„è§£ææ–¹æ¡ˆ

- æ‰“å¼€æœ¬åœ°ç½‘ç«™, é’ˆå¯¹ç»“æœçš„å¯è§†åŒ–æ˜¾ç¤º(æ ‘å½¢å›¾, çˆ¶èŠ‚ç‚¹-é‡å¤çš„åº“, å­èŠ‚ç‚¹å¯¹åº”å¤šä¸ªä¾èµ–)

## å¼€å‘

### æŒ‡ä»¤æŠ€æœ¯é€‰å‹:

1. commander

æ¨èæœ€å¤šçš„, åŒæ—¶ä¹Ÿæ˜¯ä¸‹è½½é‡æœ€å¤šçš„, ä¸‹è½½é‡ 8kw+

2. package-lock.json 

é’ˆå¯¹çš„ lock æ–‡ä»¶, é»˜è®¤ `npm` åŠå…¶å¯¹åº”çš„è§£æ, ç°åœ¨è¿˜æœ‰ `yarn`, `pnpm` æ¯”è¾ƒæµè¡Œ, ä½†æ˜¯
ä¸€èˆ¬åœ¨æœåŠ¡å™¨ä¸Šæ‰“åŒ…æ—¶éƒ½ç”¨ä½¿ç”¨ `npm` æŒ‡ä»¤

3. å¯è§†åŒ–åº“
// TODO å¯è§†åŒ–åº“ é€‰å‹, å¯ä»¥å‚è€ƒ bundle


åœ¨æœ¬æ–‡ä¸­å°†ä¼šä½¿ç”¨ä¸€ä¸ª umi é¡¹ç›®ä¸ºä¾‹

### ç¬¬ä¸€æ­¥


1. è·å–é…ç½®æ–‡ä»¶, å¯ä»¥å•ç‹¬æ–‡ä»¶, ä¹Ÿå¯åœ¨ package.json ä¸­, ä¹Ÿå¯é€šè¿‡æŒ‡ä»¤é…ç½®
2. ç¡®è®¤æœ¬åœ°æœ‰æ—  package-lock.json
3. è‹¥æœ‰åˆ™å¯¹å…¶è¿›è¡Œè§£æ, è‹¥æ— åˆ™è¿è¡Œ `npm i` væŒ‡ä»¤, å¾…å…¶ä¸‹è½½å®Œæ¯•åå†è§£æ lock æ–‡ä»¶

æ ¹æ®æˆ‘ä»¬çš„æ€è·¯å…ˆå®ç°ç¬¬ä¸€æ­¥çš„å¼€å‘:

```js
const lockPath = path.resolve('package-lock.json')

async function main() {
    const isExist = fs.existsSync(lockPath)
    // åˆ¤æ–­ lock æ–‡ä»¶, å¦‚æœä¸å­˜åœ¨åˆ™ æ‰§è¡Œ install
    if(!isExist){
        await execNpmInstall()
    }
    // è·å– lock æ–‡ä»¶å†…å®¹
    const data = fs.readFileSync(lockPath, 'utf8')
    // è§£æ json
    console.log(JSON.parse(data))
}

main()
```

### ç¬¬äºŒæ­¥

å…·ä½“çš„è§£ææ–‡ä»¶

æˆ‘ä»¬ä»¥ä¸€ä¸ªç»“æ„æ¥åˆ†æ, å–åä¸ºç»“æ„ A:

```json5
{
  "requires": true,
  "lockfileVersion": 1,
  "dependencies": {
    // çœç•¥
    "react-redux": {
      "version": "7.2.8",
      "resolved": "https://registry.npmmirror.com/react-redux/-/react-redux-7.2.8.tgz",
      "integrity": "sha512-6+uDjhs3PSIclqoCk0kd6iX74gzrGc3W5zcAjbrFgEdIjRSQObdIwfx80unTkVUYvbQ95Y8Av3OvFHq1w5EOUw==",
      "requires": {
        "@babel/runtime": "^7.15.4",
        "@types/react-redux": "^7.1.20",
        "hoist-non-react-statics": "^3.3.2",
        "loose-envify": "^1.4.0",
        "prop-types": "^15.7.2",
        "react-is": "^17.0.2"
      },
      "dependencies": {
        "@babel/runtime": {
          "version": "7.17.9",
          "resolved": "https://registry.npmmirror.com/@babel/runtime/-/runtime-7.17.9.tgz",
          "integrity": "sha512-lSiBBvodq29uShpWGNbgFdKYNiFDo5/HIYsaCEY9ff4sb10x9jizo2+pRrSyF4jKZCXqgzuqBOQKbUm90gQwJg==",
          "requires": {
            "regenerator-runtime": "^0.13.4"
          }
        },
        "react-is": {
          "version": "17.0.2",
          "resolved": "https://registry.npmmirror.com/react-is/-/react-is-17.0.2.tgz",
          "integrity": "sha512-w2GsyukL62IJnlaff/nRegPQR94C/XXamvMWmSHRJ4y7Ts/4ocGRmTHvOs8PSE6pB3dWOrD/nueuU5sduBsQ4w=="
        }
      }
    }
  }
}
```

å…ˆè®²è§£ä¸€ä¸‹ä¸»è¦çš„ key æ˜¯ä»€ä¹ˆæ„æ€:

- lockfileVersion  
  ä¸€ä¸ªæ•´æ•°çš„ç‰ˆæœ¬ï¼Œä»1å¼€å§‹æ˜¯æœ¬æ–‡æ¡£çš„ç‰ˆæœ¬å·ï¼Œåœ¨ç”Ÿæˆè¿™ä¸ªpackage-lock.jsonæ—¶ä½¿ç”¨äº†å…¶è¯­ä¹‰ã€‚
  - æœªæä¾›æ­¤å€¼, è¯´æ˜æ˜¯ npm v5 ç‰ˆæœ¬ä»¥å‰ç”Ÿæˆçš„
  - 1: npm v5å’Œv6ä½¿ç”¨çš„lockfileç‰ˆæœ¬ã€‚
  - 2: npm v7ä½¿ç”¨çš„lockfileç‰ˆæœ¬ï¼Œå‘åå…¼å®¹v1çš„lockfiles
  - 3: npm v7ä½¿ç”¨çš„é”æ–‡ä»¶ç‰ˆæœ¬ï¼Œæ²¡æœ‰å‘åå…¼å®¹çš„èƒ½åŠ›ã€‚è¿™ä¸ªç‰ˆæœ¬å¯èƒ½ä¼šåœ¨æœªæ¥çš„npmä¸­ä½¿ç”¨ã€‚
- dependencies  
  è¿™æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…åç§°åˆ°ä¾èµ–å¯¹è±¡çš„æ˜ å°„ã€‚
  - integrity
    åœ¨æ­¤ä½ç½®è§£å‹çš„æ–‡ä»¶çš„sha512æˆ–sha1æ ‡å‡†å­èµ„æºå®Œæ•´æ€§å­—ç¬¦ä¸²ã€‚å¯ç”¨äº git æäº¤ã€‚
  - resolved è¿™æ˜¯ç›¸å¯¹äºæ³¨å†Œè¡¨URLçš„å‹ç¼©åŒ…è·¯å¾„ã€‚
  - requires è¿™æ˜¯ä¸€ä¸ªæ¨¡å—åç§°ä¸ç‰ˆæœ¬çš„æ˜ å°„å…³ç³»ã€‚è¿™æ˜¯è¯¥æ¨¡å—éœ€è¦çš„æ‰€æœ‰ä¸œè¥¿çš„åˆ—è¡¨ï¼Œä¸ç®¡å®ƒå°†è¢«å®‰è£…åœ¨å“ªé‡Œã€‚
  - dependencies å’Œä»–çš„çˆ¶å…ƒç´ ä¸€æ ·, ä½†æ˜¯æ˜¯åœ¨å½“å‰åŒ…çš„ node_modules ä¸­ã€‚


åœ¨è¿™ä¸ªä¾èµ–ä¸­çš„ `dependencies` å¯¹åº”çš„åŒ…éƒ½ä¼šå­˜åœ¨äºæ­¤åŒ…çš„ node_modules ä¸­, æ¯”å¦‚:

`react-redux/dependencies/@babel/runtime`



## å‚è€ƒ

- https://docs.npmjs.com/cli/v8/configuring-npm/package-lock-json
