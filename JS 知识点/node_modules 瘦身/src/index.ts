import {Command} from 'commander';
import check from './check'
import deepCheck from './deepCheck'
import opener from 'opener'

const program = new Command();

program.command('check')
    .description('检查中:')
    .option('-d, --deep', '解析 lock 文件')
    .option('-o, --open', '打开网站')
    .action((options, command) => {
        console.log(options, options.deep);
        if (options.deep) {
            // 执行脚本
            // 额外判断 options.open
            deepCheck()
            if (options.open) {
                // opener(`file://${reportFilepath}`);
            }
        } else {
            // check
            check().then((unused) => {
                console.log(unused.dependencies); // an array containing the unused dependencies
                console.log(unused.devDependencies); // an array containing the unused devDependencies
                console.log(unused.missing); // a lookup containing the dependencies missing in `package.json` and where they are used
                console.log(unused.using); // a lookup indicating each dependency is used by which files
                console.log(unused.invalidFiles); // files that cannot access or parse
                console.log(unused.invalidDirs); // directories that cannot access
            });
        }
    });

program.parse();