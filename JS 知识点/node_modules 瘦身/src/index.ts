import {Command} from 'commander';
import check from './check'
import deepCheck from './deepCheck'
import chalk from 'chalk';
import ora from 'ora';

const main = () => {
    const program = new Command();
    program.command('check')
        .description('检查中:')
        .option('-d, --deep', '解析 lock 文件')
        .action((options) => {
            // console.log(options, options.deep);
            const spinner = ora('Loading check').start();
            if (options.deep) {
                // 执行脚本
                // 额外判断 options.open
                deepCheck(spinner) // // 同步任务容易卡主
            } else {
                // check
                check().then((unused) => {
                    spinner.succeed('解析完毕:')
                    console.log('Unused dependencies:')
                    unused.dependencies.forEach(name=>{
                        console.log(chalk.greenBright(`* ${name}`))
                    })
                    console.log('Unused devDependencies:'); // an array containing the unused devDependencies
                    unused.devDependencies.forEach(name=>{
                        console.log(chalk.greenBright(`* ${name}`))
                    })
                });
            }
        });

    program.parse();
}

export default main