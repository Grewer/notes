import commander from 'commander';
import check from './check'
import deepCheck from './deepCheck'
import chalk from 'chalk';
import ora from 'ora';

const main = () => {
    const program = new commander.Command();
    program.command('check')
        .description('检查使用库')
        .action((options) => {
            // console.log(options, options.deep);
            const spinner = ora('Loading check').start();
            
            // check
            check().then((unused) => {
                spinner.succeed('解析完毕:')
                console.log('Unused dependencies:')
                unused.dependencies.forEach(name => {
                    console.log(chalk.greenBright(`* ${name}`))
                })
                console.log('Unused devDependencies:'); // an array containing the unused devDependencies
                unused.devDependencies.forEach(name => {
                    console.log(chalk.greenBright(`* ${name}`))
                })
            });
            
        }).command('json').description('解析 lock文件').option('-d, --doc', '解析 lock 文件, 将结果保存')
        .action(async (options) => {
            const spinner = ora('Loading check').start();
            // 执行脚本
            // 额外判断 options.open
            deepCheck(spinner, options) // // 同步任务容易卡主
        })
    
    program.parse();
}

export default main