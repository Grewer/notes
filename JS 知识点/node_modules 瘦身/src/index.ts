import {Command} from 'commander';
import check from './check'
import deepCheck from './deepCheck'
import createServer from "./server";
import chalk from 'chalk';

const main = () => {
    const program = new Command();

    program.command('check')
        .description('检查中:')
        .option('-d, --deep', '解析 lock 文件')
        .option('-o, --open', '打开网站')
        .action((options, command) => {
            // console.log(options, options.deep);
            if (options.deep) {
                // 执行脚本
                // 额外判断 options.open
                deepCheck()
                if (options.open) {
                    createServer()
                }
            } else {
                // check
                check().then((unused) => {
                    console.log('Unused dependencies:')
                    unused.dependencies.forEach(name=>{
                        console.log(chalk.greenBright(`* ${name}`))
                    })
                    console.log('Unused devDependencies:'); // an array containing the unused devDependencies
                    unused.devDependencies.forEach(name=>{
                        console.log(chalk.greenBright(`* ${name}`))
                    })
                });
            }
        });

    program.parse();
}

export default main