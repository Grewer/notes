## 前言

前端基建里最重要的事情之一就是监控，性能，报错，白屏等等，而今天要说的就是白屏的监控。
前端白屏是影响用户体验的常见问题，通常有资源加载失败、JS 执行错误、渲染阻塞、框架异常等原因。
今天就以**页面生命周期、错误捕获、性能指标、框架特性**等维度来描述怎么监控。

##  关键节点判断

#### 核心原理

不管是传统框架、界面、还是现代浏览器框架，都会有一个容器节点、关键节点，例如根节点，header节点，logo 节点等等，我们要做的就是在页面加载完成之后判断它是否存在即可

### 关键检测维度

1. **元素是否存在**：`document.querySelector(selector)` 是否返回非 null 值（排除因 HTML 结构错误导致的元素缺失）。
2. **是否有实际内容**：元素的 `textContent.trim()` 不为空（排除空标签），或 `childNodes.length > 0`（存在子元素）。
3. **是否可见**：
    - 布局可见性：`offsetHeight > 0` 且 `offsetWidth > 0`（排除 `display: none` 或内容被完全遮挡）。
    - 样式可见性：`getComputedStyle(element).visibility !== 'hidden'` 且 `opacity > 0`（排除透明或隐藏样式）。

```js
function checkCriticalElement(selector, options = {}) {
  const { 
    timeout = 5000,   // 超时阈值（默认5秒）
    interval = 500,   // 检测间隔（默认500ms，平衡精度与性能）
    onWhiteScreen = () => {} // 白屏回调
  } = options;

  const startTime = Date.now();
  const timer = setInterval(() => {
    const now = Date.now();
    // 1. 超时判断：超过阈值仍未检测到有效元素，触发白屏
    if (now - startTime > timeout) {
      clearInterval(timer);
      onWhiteScreen({
        type: 'critical_element_timeout',
        selector,
        duration: now - startTime,
        reason: '元素未在规定时间内加载完成'
      });
      return;
    }

    // 2. 元素存在性检测
    const element = document.querySelector(selector);
    if (!element) return; // 元素未加载，继续等待

    // 3. 内容有效性检测
    const hasContent = element.textContent.trim() !== '' || element.childNodes.length > 0;
    if (!hasContent) return; // 元素存在但无内容，继续等待

    // 4. 可见性检测
    const computedStyle = getComputedStyle(element);
    const isVisible = 
      element.offsetHeight > 0 && 
      element.offsetWidth > 0 && 
      computedStyle.visibility !== 'hidden' && 
      computedStyle.opacity > 0;

    if (isVisible) {
      clearInterval(timer); // 所有条件满足，停止检测
    }
  }, interval);
}
```


## 错误捕获


## 基于性能指标的检测


## 框架钩子监听


## 像素检测




## 小结

单一方法难以覆盖所有白屏场景，需结合多种手段形成闭环：

| 方法类型   | 核心手段                                 | 适用场景         |
| ------ | ------------------------------------ | ------------ |
| 关键元素检测 | 定时检查 DOM 存在性和内容                      | 首屏加载、路由切换后白屏 |
| 错误捕获   | JS 错误、资源加载错误                         | 代码异常导致的白屏    |
| 性能指标监控 | FCP、LCP、DOM 就绪时间                     | 渲染阻塞导致的白屏    |
| 框架异常监听 | Vue errorHandler、React ErrorBoundary | 组件渲染错误导致的白屏  |
| 视觉检测   | 内容高度 / 像素分析                          | 样式错乱导致的白屏    |